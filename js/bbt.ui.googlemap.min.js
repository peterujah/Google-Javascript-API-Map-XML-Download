/*!
 Javascript Google map with xmal download and autocomplete search from xml
 Created 20/04/2019 by Ujah Peter Chigozie Block BlockByte Tech LTD Nigeria
 Version 1.0
*/
var autocomplete,markerz=[];
function initGoogleMap(){var c=new google.maps.Map(document.getElementById("undefined"===typeof settings.mapElementId?"map":settings.mapElementId),{zoom:"undefined"===typeof settings.current.zoom?!0:settings.current.zoom,center:"undefined"===typeof settings.current.center?!0:settings.current.center,mapTypeControl:"undefined"===typeof settings.customize.mapTypeControl?!0:settings.customize.mapTypeControl,panControl:"undefined"===typeof settings.customize.panControl?!0:settings.customize.panControl,zoomControl:"undefined"===
typeof settings.customize.zoomControl?!0:settings.customize.zoomControl,streetViewControl:"undefined"===typeof settings.customize.streetViewControl?!0:settings.customize.streetViewControl,clickableIcons:"undefined"===typeof settings.customize.clickableIcons?!0:settings.customize.clickableIcons,fullscreenControl:"undefined"===typeof settings.customize.fullscreenControl?!0:settings.customize.fullscreenControl}),a=document.getElementById("undefined"===typeof settings.searchElementId?"serchLocation":
settings.searchElementId),e=new google.maps.InfoWindow;autocomplete=new google.maps.places.Autocomplete(a);autocomplete.bindTo("bounds",c);autocomplete.setComponentRestrictions({country:settings.current.country});settings.customize.placeSearchInMapBox&&c.controls[google.maps.ControlPosition.TOP_LEFT].push(a);blockByteGoogleMap.copyright(c,google.maps);autocomplete.addListener("place_changed",function(){var b=autocomplete.getPlace();if(b.geometry){markerz.forEach(function(c){c.setMap(null)});b.geometry.viewport?
(c.fitBounds(b.geometry.viewport),c.panToBounds(b.geometry.viewport)):c.setZoom(16);c.setCenter(b.geometry.location);var a=new google.maps.LatLng(b.geometry.location.lat(),b.geometry.location.lng());a=new google.maps.Marker({map:c,position:a,icon:{url:settings.icons.ripple,scaledSize:new google.maps.Size(300,300),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(150,150)},label:""});markerz.push(a);blockByteGoogleMap.fillInAddress(b);var d=document.getElementById("locality").value,f=
document.getElementById("administrative_area_level_1").value,g=document.getElementById("country").value,h=encodeURI(settings.onChangeUrlApi+"change=true&city="+d+"&country="+g+"&state="+f);localStorage.setItem("city",d);localStorage.setItem("state",f);localStorage.setItem("country",g);blockByteGoogleMap.fetch(h,!0).then(function(b){if("object"===typeof b)var a="undefined"!=typeof b.responseXML&&b.responseXML.length?b.responseXML:b;else"string"===typeof b&&(a=new DOMParser,xmlText=b,a=a.parseFromString(xmlText,
"text/xml"));"undefined"!=typeof a&&null!=a&&(b=a.documentElement.getElementsByTagName("marker"),blockByteGoogleMap.createInfoWindow(c,b,"onChange",e))});a.setPlace({placeId:b.place_id,location:b.geometry.location});a.setVisible(!0)}});a=localStorage.getItem("city");var d=localStorage.getItem("state"),f=localStorage.getItem("country");a=encodeURI(settings.onLoadUrlApi+"ready=true&city="+a+"&country="+f+"&state="+d);blockByteGoogleMap.fetch(a,!0).then(function(b){if("object"===typeof b)var a="undefined"!=
typeof b.responseXML&&b.responseXML.length?b.responseXML:b;else"string"===typeof b&&(a=new DOMParser,xmlText=b,a=a.parseFromString(xmlText,"text/xml"));"undefined"!=typeof a&&null!=a&&(b=a.documentElement.getElementsByTagName("marker"),blockByteGoogleMap.createInfoWindow(c,b,"onLoad",e))})}
var blockByteGoogleMap={statics:{componentForm:{route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",country:"long_name"}},fillInAddress:function(c){for(var a in this.statics.componentForm)document.getElementById(a).value="",document.getElementById(a).disabled=!1;for(a=0;a<c.address_components.length;a++){var e=c.address_components[a].types[0];if(this.statics.componentForm[e]){var d=c.address_components[a][this.statics.componentForm[e]];document.getElementById(e).value=
d}}},geolocate:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(c){c=new google.maps.Circle({center:{lat:c.coords.latitude,lng:c.coords.longitude},radius:c.coords.accuracy});autocomplete.setBounds(c.getBounds())})},fetch:function(c){return new Promise(function(a,e){var d=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;d.open("GET",c);d.onload=function(){200==d.status?a(d.response):e(Error(d.statusText))};d.onerror=function(){e(Error("Network Error"))};
d.send()})},copyright:function(c,a){var e=document.createElement("div"),d=document.createElement("a"),f=document.createElement("span");document.createElement("br");e.setAttribute("style","display: block;");d.setAttribute("href","https://github.com/peterujah");d.setAttribute("style","color: #000;text-decoration: none;display: block;");f.setAttribute("style","font-weight:700;display: block;padding: 5px;font-size: 15px;background-color: #fff");f.textContent="Created By BlockByte Tech";d.appendChild(f);
e.appendChild(d);c.controls[a.ControlPosition.BOTTOM_LEFT].push(e)},removeMarker:function(){for(var c=0;c<markerz.length;c++)markerz[c].setMap(null);markerz=[]},doNothing:function(){},createInfoWindow:function(c,a,e,d){var f={url:settings.icons.pinned,scaledSize:new google.maps.Size(40,40),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)};Array.prototype.forEach.call(a,function(a){var b=document.createElement("div"),e=document.createElement("strong"),l=document.createElement("br"),
g=document.createElement("span"),h=document.createElement("text"),n=a.getAttribute("id"),k=a.getAttribute("name"),p=a.getAttribute("address"),q=a.getAttribute("type");a=new google.maps.LatLng(parseFloat(a.getAttribute("lat")),parseFloat(a.getAttribute("lng")));b.setAttribute("class","text-center app-map-info-window");e.textContent=k;g.textContent=k;g.title=k;g.setAttribute("class","strong map-span-link");g.setAttribute("data-address-id",n);h.textContent=p;b.appendChild(l);b.appendChild(g);b.appendChild(l);
b.appendChild(h);var m=new google.maps.Marker({map:c,position:a,icon:f,label:(settings.customLabel[q]||{}).label});m.addListener("click",function(){d.setContent(b);d.open(c,m)})})}};function registerGoogleApi(){return"undefined"===typeof google||"undefined"===typeof google.maps?$.getScript("https://maps.googleapis.com/maps/api/js?key="+settings.apiKey+"&libraries=places&callback=initMap"):(new $.Deferred).resolve(google.maps)}registerGoogleApi().then(function(){initGoogleMap()});